# dcdiff
dcdiff is a tool for automatic differential forensic analysis on domain controllers to reverse engineer TTPs and gather IOCs.  
It records what arbitrary attack techniques have changed on the domain controller. For this purpose, a volume shadow copy is first generated by the capture module capture.ps1, which serves as a baseline. Then, arbitrary operations and attacks can be executed manually within the network. For the exampleReport the attack technique utilizing SMB-AutoBrute has been executed on a client workstation to gather passwords from Active Directory. After that, a volume shadow copy is generated again by dcdiff. Both shadow copies are differenced, and the results are transferred to a report by the compare module compare.ps1. Finally, all changed files, the changes in the user access logs, the changes in the NTDS database and EVTX events are displayed.

It was developed in the context of a master thesis and is to be considered as proof of concept.

## REQUIREMENTS
dcdiff is intended to run on a virtual Lab Windows Server operating system using Active Directory Domain Services.
Windows Server is mandatory because only this also has the create switch in vssadmin to create volume shadow copies.

### External dependencies:
Python 3.x (tested with 3.10)

download & build libesedb from https://github.com/libyal/libesedb (esedbexport.exe need to be in $PATH)

Kstrike.py from https://raw.githubusercontent.com/backi83/KStrike/ (requires Python 3.x)

csv-diff (pip install csv-diff)


## USAGE

Open a PowerShell console and execute capture.ps1. It's interactive.  
Enter a name to identify the report.  
Enter an existing path or leave blank for using current directory for all generated files.  
Then the script waits for you to manually execute any kind of actions causing changes to the domain controller.  
By pressing any key when done, it will continue with the comparison and finally outputs the report to the results folder.  
  
If you have issues, there is also a log.txt file within the given directory.
